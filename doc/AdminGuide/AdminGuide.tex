
% File:  AdminGuide.tex
% Copyright (C) 2004 The Institute for System Programming of the Russian Academy of Sciences (ISP RAS)

\documentclass[a4paper,12pt]{article}
\font\mmmm cmtt10
\makeatletter
\def\verbatim@font{\mmmm}
\makeatother
\usepackage[english]{babel}
\usepackage[dvips]{epsfig}
\usepackage[dvips]{graphics}
\usepackage{epic}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{theorem}
\newtheorem{definition}{Definition}
{\theorembodyfont{\rmfamily} \newtheorem{proof}{Proof}}
\newtheorem{theo}{Theorem}
\newtheorem{note}{Note}

%\usepackage[html,4,section+]{tex4ht}

%to avoid processing \TocAt by latex
\newcommand{\TocAt}[6]{}


\usepackage[dvips]{epsfig}

\usepackage{multirow}

\title{Sedna Administration Guide}
%\author{Peter Pleshachkov}
\date{}

\begin{document}
\sloppy
\maketitle
\TocAt*{section,subsection,subsubsection}
\TocAt*{subsection,subsubsection}
\tableofcontents

\section{Introduction}
This guide describes administration of the Sedna XML Database Management System (Sedna for short). Sedna has the following components.

\emph{Governor} serves as  ``control center'' of the system. All other components register at the Governor. The Governor knows which other components (e.g. databases and sessions) are running in the system and controls them. Other components cannot function properly if the Governor is not running so you must start it to use Sedna. Besides, Governor is responsible for handling remote client's requests. For each request it creates a session which keeps the direct connection with client. Then the client interacts with the system via session. You may run only one instance of the Governor.


\emph{Session} keeps the client's settings and allows client to run a sequence of transactions. The transactions within a session are strictly serial, that is one transaction ends before next one starts, there is only one active transaction per session. Transaction provides functionality required for execution of the client's queries. The query execution consists of several steps: (1) parsing of the query and translation of the query into its logical representation, (2) processing of the logical representation by optimizer that produces the optimal query execution plan, (3) execution of the optimal query plan and passing results to the client. Transaction is rolled back if error is occurred during its execution.

\emph{Storage manager} manages a database and provides memory management functionality to the executor. There is an instance of storage manager for each database run. 

All the components described above are implemented as operating system processes.
 

One can run sessions via Sedna client applications (See Sedna Programmer's Guide how to use Sedna APIs) or via Sedna interactive terminal (see \ref{terminal}). In both cases, first of all the Governor and storage managers (one for each databases required) components should be run.


There are a set of command line utilities that allow you to administrate all aspects of Sedna.
These utilities are described in detail in the following section.

\section{Sedna Administration via Command Line}

\subsection{Sedna Directory Structure}
\label{sec:dir-structure}
The Sedna directory hierarchy is fundamental to obtaining an overall understanding of the system. 

%This section describes 
%how the Sedna directory structure is set up and what it contains for different kinds of Sedna packages.

%\subsubsection{Sedna Installed from Precompiled Binaries}
%\label{sec:binary-pack}
%If you install Sedna from precompiled binaries, the directory structures are identical on Windows and Linux platforms.
Below \verb!SEDNA_INSTALL! refers to the directory where Sedna is installed. The directory structures are identical on Windows and Linux platforms.

\begin{verbatim}
SEDNA_INSTALL/bin          command line utilities for managing 
                           Sedna and databases, running queries, etc.
SEDNA_INSTALL/cfg          database configuration files named 
                           <db_name>_cfg.xml, where <db_name> is 
                           the name of the corresponding database
SEDNA_INSTALL/data         database data stored in subdirectories 
                           named <db_name>_files, where <db_name> 
                           is the name of the corresponding database 									
SEDNA_INSTALL/lib          database-independent libraries of external 
                           functions
SEDNA_INSTALL/data/<db_name>_files/lib        
                           database-specific libraries of external
                           functions                  
SEDNA_INSTALL/doc          Sedna documentation
SEDNA_INSTALL/driver       API drivers for various programming languages
SEDNA_INSTALL/include      include files
SEDNA_INSTALL/etc          Sedna config file sednaconf.xml
SEDNA_INSTALL/examples     example databases and applications for 
                           the Sedna APIs
SEDNA_INSTALL/share        Sedna database metadata files (currently only 
                           database users and privileges metadata)
\end{verbatim}

For the installation instructions see INSTALL file shipped with the Sedna distribution.
%\subsubsection{Sedna Installed from RPM or DEB Packages}
%\label{sec:rpm-deb-pack}
%If you install Sedna from RPM or DEB packages on Linux, the directory structure is as follows.
%Below \verb!PREFIX! refers to the directory where Sedna is installed. 
%\verb!SHARE_PREFIX! is defined as /usr/share if \verb!PREFIX! is \verb!/! and \verb!SHARE_PREFIX! is defined as \verb!PREFIX/share! otherwise.

%\begin{verbatim}
%PREFIX/bin/se_*                     command line utilities for managing 
%                                    Sedna and databases, running queries
%PREFIX/etc/sednaconf.xml            Sedna configuration file
%/etc/sednaconf.xml                  Sedna configuration file if it is not 
%                                    found in PREFIX/etc (optional)
%PREFIX/include/libsedna.h           C API header file
%PREFIX/include/sedna_ef.h           Sedna C external function API header file
%PREFIX/lib/libsedna.a               C API driver for Sedna
%SHARE_PREFIX/doc/sedna-x.x.x        Sedna documentation
%SHARE_PREFIX/java/sednadriver.jar   Java API Driver for Sedna
%/var/lib/sedna/cfg                  database configuration files named 
%                                    <db_name>_cfg.xml, where <db_name> is
%                                    the name of the corresponding database
%/var/lib/sedna/data                 databases stored in subdirectories named
%                                    <db_name>_files, where <db_name> is the 
%                                    name of the corresponding database
%/var/lib/sedna/lib                  database-independent libraries of external 
%                                    functions
%/var/lib/sedna/data/<db_name>_files/lib
%                                    database-specific libraries of external
%                                    functions
%SHARE_PREFIX/sedna-x.x.x/examples   example databases and applications for 
%                                    the Sedna APIs
%SHARE_PREFIX/sedna-x.x.x/driver     additonal API drivers 
%\end{verbatim}

%\subsubsection{Sedna Installed from Source Code}
%If you install Sedna from source code using \verb!make install!, the directory structure is the same as described in Section \ref{sec:binary-pack}.
%If you install Sedna from source code using \verb!make dispersal_install!, the directory structure is the same as described in Section \ref{sec:rpm-deb-pack}. Note that the latter is available only on %Linux. 

\subsection{Managing Sedna}
\subsubsection{Running Sedna}
\label{StartSedna}

To start the Sedna server one should start \emph{Governor} by executing the \verb!se_gov! command. This starts the main server component. After it Administrator can run databases (as discussed in Section \ref{RunDB}).


The usage of the \verb!se_gov! command is as follows:

\begin{verbatim}
Usage: se_gov [options]

options:
  --help                   display this help and exit
  -help                    display this help and exit
  -version                 display product version and exit
  -background-mode on/off  start the server in the background mode 
                           (default on)
  -port-number <int>       socket listening port
                           (default 5050)
\end{verbatim}

\verb!--help! and \verb!-help! options provide the exhaustive information about the \verb!se_gov! command.
\verb!-version! option allows getting the version of the \emph{Governor}.
The fourth option \verb!-background-mode! allows Administrator to start \emph{Governor} in the background mode. Finally, last option \verb!-port-number! allows to set up the Sedna connection port number. The default value is 5050.

To get the information about running Sedna components one can use \verb!se_rc! command.

The usage of the \verb!se_rc! command is as follows:

\begin{verbatim}
Usage: se_rc [options]

options:
  --help		   display this help and exit
  -help			   display this help and exit
  -version		   display product version and exit
\end{verbatim}


\subsubsection{Stopping Sedna}

To stop Sedna, Administrator should use the \verb!se_stop! command. This command stops all Sedna components including all databases, which are run. The command should be run without input parameters. But the command has several optional parameters.

The usage of the \verb!se_stop! command is as follows:

\begin{verbatim}
Usage: se_stop [options]

options:
  --help                   display this help and exit
  -help                    display this help and exit
  -version                 display product version and exit
\end{verbatim}
The first and second options are straightforward, typing these options Administrator can get the exhaustive information about the \verb!se_stop! command. Option \verb!-version! allows getting the version of the \verb!se_stop!.

Note that \verb!se_stop! command causes a roll back of all active transactions in the system.

\subsubsection{Configuring Sedna}
\label{sec:ConfigSedna}
Sedna configuration parameters are stored in the configuration file \verb!sednaconf.xml! located in
\verb![win:] PREFIX\etc!, \verb![linux:] PREFIX/etc! or \verb![linux:]/etc!. On Linux, \verb!sednaconf.xml! is searched in the following order: \verb!PREFIX/etc!, \verb!/etc!. The file is optional. If there is no such file, the default values are used.
The file is an XML document, which satisfies the following DTD:

\begin{verbatim}
<!ELEMENT sednaconf (sedna_data, os_primitives_id_min_bound, listener_port,
 ping_port)>
<!ELEMENT sedna_data (#PCDATA)>
<!ELEMENT os_primitives_id_min_bound (#PCDATA)>
<!ELEMENT listener_port (#PCDATA)>
<!ELEMENT ping_port (#PCDATA)>
\end{verbatim}

The \verb!sedna_data! element contains the path to the directory where 
database configuration files (in the \verb!cfg! subdirectory) and 
databases (in the \verb!data! subdirectory) are stored. The path by default is
\verb![win:] PREFIX! \verb![linux:] /var/lib/sedna!.

The \verb!os_primitives_id_min_bound! element defines the minimal value for identifiers of OS resources (e.g. semaphores) used in Sedna. In order to run several Sedna instances on one machine Administrator should configure this parameter in a such way that identifiers belonging to different Sedna instances does not intersect. In a standard configuration one Sedna instance acquires a range of identifiers which length is equal to 150.

The \verb!listener_port! element defines the port number for listening for a connection requests from a client.

The \verb!ping_port! element defines the port number of Sedna ping server that is an internal kernel mechanism. It is used to stop all Sedna processes in case of crash. 
 
To tune the Sedna configuration, Administrator should edit the proper elements of the Sedna configuration file. Note, in order for new configuration to take effect you must restart Governor.

\subsection{Managing Databases}
\subsubsection{Creating a Database}
\label{CreateDB}
To create a database, use the \verb!se_cdb! command.

Each database consists of the following files, which are located as described in Section \ref{sec:dir-structure}.

\begin{itemize}
\item The \verb!<db_name>.sedata! file is used for storing persistent XML data, which are loaded to the database by user using LOAD/UPDATE expressions. 
\item The \verb!<db_name>.setmp! file is used for storing temporary XML data. It appears in the database during query execution and contains intermediate results.
\item The \verb!<db_name>.*.seph! files are used for storing XML metadata (for example, the descriptive scheme of XML documents).
\item The \verb!<db_name>.*llog! files are used for storing database logical log.
%\item The \verb!buf! directory contains some intermidiate data. It is created when the database is run and removed when the database is stopped.
\end{itemize}

Besides, for each database there are run-time configuration parameters, which are stored in the database configuration file (see Section \ref{ConfigDB}).

The usage of the \verb!se_cdb! command is as follows:

\begin{verbatim}
Usage: se_cdb [options] db_name

options:
  -help                         display this help and exit
  --help                        display this help and exit
  -version                      display product version and exit
  -data-file-max-size Mbs       the max size of data file (in Mb),
                                infinite size by default
  -tmp-file-max-size Mbs        the max size of tmp file (in Mb),
                                infinite size by default
  -data-file-ext-portion Mbs    the data file extending portion size 
                                (in Mb), default 100Mb
  -tmp-file-ext-portion Mbs     the tmp file extending portion size
                                (in Mb), default 100Mb
  -data-file-init-size Mbs      the data file initial size (in Mb),
                                default 100Mb
  -tmp-file-init-size Mbs       the tmp file initial size (in Mb),
                                default 100Mb
  -persistent-heap-size Mbs     the persistent heap size (in Mb),
                                allowed in the range of 10Mb - 99Mb,
                                default 10Mb
  -bufs-num N                   the number of buffers in main memory,
                                default 1600
  -max-trs-num N                the number of concurrent micro transactions
                                over database, default 20

db_name         the name of the database to be created
\end{verbatim}


The first and second options are straightforward, typing one of these options Administrator can get the exhaustive information about the \verb!se_cdb! command.

The third option allows getting the version of the \verb!se_cdb! command.

The \verb!-data-file-max-size! option allows Administrator to set up the maximum size (in Mb) of the file where the persistent data are stored. The default value for this option is infinite.

The \verb!-tmp-file-max-size! option allows Administrator to set up the maximum size (in Mb) of the file where the temporary data are stored. The default value for this option is infinite.

The \verb!-data-file-ext-portion! option allows Administrator to set up the size (in Mb) of the portion to which the persistent data file will be extended as result of executing resize operation. Resize operation is applied to the persistent data file if its size is less than needed for storing XML documents. The default value is 100 Mb.

The \verb!-tmp-file-ext-portion! option allows Administrator to set up the size of the portion to which the temporary data file will be extended as result of executing resize operation. The resize operation is applied to the temporary data file if its size is less than needed for storing temporary data (intermediate results of the query, for example). The default value is 100 Mb.

The \verb!-data-file-init-size! option allows Administrator to set up the initial size (in Mb) of the persistent data file. It is obvious that the initial size can't be greater than the maximum size of the persistent data file. The default value is 100 Mb.

The \verb!-tmp-file-init-size! option allows Administrator to set up the initial size (in Mb) of the temporary data file. It is obvious that the initial size can't be greater than the maximum size of the temporary data file. The default value is 100 Mb.

The \verb!-persistent-heap-size! option allows Administrator to set up the size (in Mb) of the metadata file (for example the descriptive schema stores in this file) This file cannot be resized. The default value is 10 Mb.

The \verb!-bufs-num! option allows Administrator to set up the number of buffers in main memory. This number is connected with the size of the main memory, but the performance of the database depends of this number very much. The default value is 1600 buffers, which is equal to 100Mb and we do not recommend to use less number of buffers. The size of one buffer is 64Kb and can't be customized by Administrator.

The \verb!-max-trs-num! option is the parameter of the Sedna Storage Manager. In current version of Sedna only default value can be used for this parameter.

The last parameter \verb!db_name! is the name of the database to be created. Administrator can use the arbitrary sequence of latin characters and digits for database name. There  cannot be two databases with the same name.

\subsubsection{Configuring a Database}
\label{ConfigDB}
For each database there is a set of run-time configuration parameters, which store in the database configuration file. The name of the database configuration file is \verb!<db_name>_cfg.xml! where \verb!<db_name>! is the name of the database. The location of configuration file is \verb![win:] PREFIX\cfg! \verb![linux:] PREFIX/cfg! or \verb![linux:] /var/lib/sedna/cfg! or as specified in the Sedna configuration file (see Section \ref{sec:ConfigSedna}) for both Windows and Linux. 

The configuration file is an XML document, which satisfies the following DTD: 

\begin{verbatim}
<!ELEMENT db (name, bufs_num, max_trs_num, init_phys_log_size, phys_log_ext_portion)>
<!ELEMENT name (#PCDATA)>
<!ELEMENT bufs_num (#PCDATA)>
<!ELEMENT max_trs_num (#PCDATA)>
<!ELEMENT init_phys_log_size (#PCDATA)>
<!ELEMENT phys_log_ext_portion (#PCDATA)>
\end{verbatim}

The root of the XML document is the \verb!db! element, which contains three elements: \verb!name!, \verb!bufs_num!, \verb!max_trs_num!. The \verb!name! element defines the name of the database. The \verb!bufs_num! element defines the number of buffers in main memory for Storage Manager component. The semantic of \verb!max_trs_num! element we will define in next version of Sedna. The \verb!init_phys_log_size! and \verb!phys_log_ext_portion! elements define the initial size of physical log and the size of physical log extension portion respectively.

To tune the database run-time configuration, Administrator should edit the proper elements of the database configuration file. Note, in order for new configuration to take effect you must restart Storage Manager.

\subsubsection{Deleting a Database}

To drop a database, use the \verb!se_ddb! command.

The usage of the \verb!se_ddb! command is as follows:

\begin{verbatim}
Usage: se_ddb [options] dbname

options:
  --help                   display this help and exit
  -help                    display this help and exit
  -version                 display product version and exit
   db-name                 The name of the database
\end{verbatim}

The first and second options are straightforward, typing one of these options Administrator can get the exhaustive information about the \verb!se_ddb! command.

The third option allows getting the version of the \verb!se_ddb! command.

The last parameter \verb!db_name! is the name of the database to be dropped.

Note that Administrator must stop database firstly (see \ref{StopDB}) and then run \verb!se_ddb! utility. 

\subsubsection{Running a Database}
\label{RunDB}

To run the database with name \verb!db_name! Administrator should use \verb!se_sm! command. The run-time configuration parameters of the database can be set by means of \verb!se_sm! command line options. If configuration parameter is not set via command line option, than the database Storage Manager retrieves the default value of this parameter from configuration file (see section \ref{ConfigDB}).

The usage of the \verb!se_sm! command is as follows:

\begin{verbatim}
Usage: se_sm [options] dbname

options:
  -help                    display this help and exit
  --help                   display this help and exit
  -version                 display product version and exit
  -background-mode on/off  start the server in the background mode (default on)
  -bufs-num N              the number of buffers in main memory,
                           (default value retrieved from config file)
  -max-trs-num N           the number of concurrent micro transactions over
                           database, (default value retrieved from config file)
   db-name                 The name of the database
\end{verbatim}


The first and second options are straightforward, typing this option Administrator can get the exhaustive information about the \verb!se_sm! command.

The third option allows getting the version of the \verb!se_sm! command.
The \verb!-background-mode! option allows Administrator to start database in the background mode.

The \verb!-bufs-num! option allows to set up the number of buffers in main memory. This number is connected with the size of the main memory, but the performance of the database depends of this number very much. The default value is retrieved from configuration file. The size of one buffer is 64Kb and can't be customized.


The \verb!-max-trs-num! option will allow setting up the number of concurrent micro transactions over database. In current version of Sedna only default value can be used for this parameter.


The last parameter \verb!dbname!  defines the name of the database to be started up. 


Note: before running any database be sure that Sedna Server is strarted up (see section \ref{StartSedna}).

\subsubsection{Stopping a Database}
\label{StopDB}

To stop the database with name \verb!db_name!, Administrator should use \verb!se_smsd! command. This command takes one input parameter, which defines the name of the database to be shut down. The usage of the \verb!se_smsd! command is as follows:

\begin{verbatim}
Usage: se_smsd [options] dbname

options:
  --help                   display this help and exit
  -help                    display this help and exit
  -version                 display product version and exit
   db-name                 The name of the database
\end{verbatim}

The first and second options are straightforward, typing these options Administrator can get the exhaustive information about the \verb!se_smsd! command.
The third option allows getting the version of the \verb!se_smsd!.

Note that \verb!se_smsd! command causes a roll back of all active transactions executed over \verb!db_name! database.


\subsection{Sedna Terminal}
\label{terminal}
\verb!se_term! is an interactive terminal to Sedna. It is a C application that uses Sedna C API (see "Sedna Programmer's Guide") to work with Sedna. It enables you to open a session to one of the Sedna database, type in queries interactively, issue them to the database and see the query results. Alternatively, input can be from a file, or a single query can be passed for execution as a command line parameter. In addition, it provides a number of meta-commands. 

The usage of the \verb!se_term! is as follows:

\begin{verbatim}
Usage: se_term [options] dbname

options:
  -help			      display this help and exit
  --help		      display this help and exit
  -version		      display product version and exit
  -file filename	  file with an XQuery query			  
  -output filename	  output file (default stdout)
  -query "query"	  XQuery query to execute		
  -echo on/off		  display se_term output  (default: on for interactive mode,
                                                        off for batch mode)
  -show-time on/off	  show time of the latest query execution (default off)
  -debug  on/off      execute statements in debug mode (default off)
  -host host		  hostname of the machine with Sedna running (default localhost)
		
  -port-number port	  socket listening port  (default 5050)
  -name name		  user name 
  -pswd password	  user password 
   db-name		      database name
\end{verbatim}

\verb!-help! or \verb!--help! provides the exhaustive information about the \verb!se_term!.

\verb!-version! option allows getting the version of the \verb!se_term!.

\verb!-file! option specifies the name of the file that contains any number of queries and meta-commands. \verb!se_term! uses this file as the source of queries and meta-commands instead of reading them interactively. \verb!se_term! executes the queries and meta-commands from file consequently and exit.

\verb!-output! option specifies a filename of a file to redirect all \verb!se_term! output to. 

\verb!-query! option specifies the query to execute.

\verb!-echo! option specifies if \verb!se_term! output needs to be displayed or not. If the \verb!echo! is on, the output is displayed, if the \verb!echo! is off, the output is not displayed. By default, the \verb!echo! option is set to on when using \verb!se_term! in an interactive mode, and the \verb!echo! option is set to off when using \verb!se_term! in a batch mode (running queries/commands from file).

\verb!-show-time! option allows getting the time of the latest query execution. If used with the \verb!-query! option provides the time of the specified query execution; if used with the \verb!-file! option provides the time of the execution of the last query in file.

\verb!-debug! option specifies session debug mode. If \verb!-debug! option is on, statements of this session are executed in a debug mode. If \verb!-debug! option is off, statement of this session are executed in normal (not debug) mode. For details see "Debug Facilities" section of the Sedna Programmer's Guide.
\verb!-host! option specifies the name of the machine with Sedna DBMS running. If not used, default value \verb!localhost! is used.

\verb!-port! option specifies the TCP/IP port on which Sedna server is listening to client applications. If omitted, port number 5050 is used by default.

\verb!-name! and \verb!-password! options specify the user name and the password. If omitted, connects as a predefined user \verb!SYSTEM! with password \verb!MANAGER!.

\verb!dbname! is a non-option argument. It specifies the name of the database to connect to.

When \verb!se_term! is used in the interactive mode it takes in query/update statements and meta-commands from stdin. To execute a query/update statement type in a statement and use ampersand and line feed to terminate it (\verb!&'\n'! terminates the query). An end of line does not terminate the query, thus queries can be spread over several lines for clarity. Alternatively, \verb!se_term! can be used in a batch mode, then query/update statements and meta-commands are taken from the input file specified by the \verb!-file! option. By default, \verb!se_term! session is run in the \emph{autocommit mode}, that is, each statement is run in a separate transaction. To switch to a \emph{manual-commit mode} use \verb!unset! meta-command (\verb!se_term! meta-comands are described below in this section). If the statement executed successfully, the results are displayed on the screen.

\verb!se_term! returns 0 to the shell if it finished normally, 1 if a fatal error of its own (out of memory, file not
found) occurs, 2 if the connection to the Sedna server went bad and the session is not interactive, and 3 if
a statement or a command failed and the variable \verb!ON_ERROR_STOP! was set (\verb!se_term! internal variables are described below in this section).

Meta-commands are commands for \verb!se_term! that proccessed by the \verb!se_term! itself. A meta-command begins with a backslash and that differs it from the query/update statements. Thus, the format of \verb!se_term! meta-command is the backslash, followed immediately by a command, with no ampersand at the end. \verb!se_term! takes in the following meta-commands:

\begin{verbatim}
 \? - for help on internal slash commands
 \commit - to commit transaction
 \rollback - to rollback transaction
 \showtime - to show the time of the latest query execution
 \set - to set the terminal internal variable
 \unset - to unset the terminal internal variable
 \quit - to close session and quit the Sedna Terminal
\end{verbatim}

\verb!set! and \verb!unset! meta-commands are used for managing \verb!se_term! internal variables. There are following \verb!se_term! internal varibales:

\verb!AUTOCOMMIT! - when set, autocommit mode is on. When unset manual-commit mode is on. \verb!AUTOCOMMIT! is set by default.

\verb!ON_ERROR_STOP! - when set, \verb!se_term! returns with the code 3 when statement or meta-command fails. When unset \verb!se_term! processing continues, unless it is the connection failure.

\verb!DEBUG! - when set, session debug mode is on. When unset, session debug mode is off. See "Debug Facilities" section of the Sedna Programmer's Guide for details.


\subsection{Backup and Restore}

As any database system that contains valuable data, Sedna databases should be backed up regularly.
In this section we present different aproaches to back up Sedna data and the process of 
migration between different Sedna releases.


\subsubsection{Export/Import Utility}

The purpose of \verb!se_exp! utility is to provide functionality of exporting/importing data. The 
idea behind the \verb!se_exp! method is to generate a set of XML files and XQuery 
scripts to restore the database in the same state as it was at the time of the exporting. 

Note that \verb!se_exp! is a regular Sedna client application. This means that you can export data from
any remote host that has access to Sedna. The requirement is that \verb!se_exp! should operate with 
special permissions. In particular, it must have read access to all documents in the database including 
system metadata. This means that you should run it as a user which has DBA role.

The usage of \verb!se_exp! utility is:

\begin{verbatim}
se_exp [options] command dbname path
options:
  -help                   display this help and exit
  --help                  display this help and exit
  -version                display product version and exit
  -verbose on/off         verbose output (default off)
  -host host              hostname of the machine with Sedna running
                          (default localhost)
  -port-number port       socket listening port  (default 5050)
  -name name              user name
  -pswd password          user password
   command                export | restore | import
   db-name                database name
   path                   path to exported/imported data
\end{verbatim}


There are three commands to manipulate data with \verb!se_exp!. They are \verb!export!,
\verb!restore! and \verb!import!. Below we describe each of these commands in details.




\subsubsection*{Export}
The purpose of \verb!export! command is to export data from specified database. The basic usage 
of this command is:

\begin{verbatim}
se_exp export dbname path
\end{verbatim}

The parameter \verb!dbname! specifies the database in Sedna to export data from. 

The \verb!path! parameter specifies the directory to store files with exported data. 

\begin{note}
Note that if the directory to which \verb!path! refers contains files that have the same names as the files created by \verb!se_exp! they will be replaced. 
\end{note}

While export process \verb!se_exp! generates a set of XML files and a set of XQuery scripts to 
recreate the state of database. For each XML document in the database including XML documents in
collections \verb!se_exp! generates an XML file. Some XML files with system metadata are also
generated. Note that the security metadata is exported in insecure way (the file contains 
unencrypted user names and passwords).

Exported data created by \verb!se_exp! is transaction consistent, that is, updates to the database 
while \verb!se_exp! is running will not be in the exported data. 

To specify which database server \verb!se_exp! should contact, use the command line options 
\verb!-host host!. The default host is the local host. As Sedna client application, \verb!se_exp! 
requires user name and password to connect to the database. You can either specify them with 
\verb!-name! and \verb!-pswd! options or type user name and password in the dialog while 
running \verb!se_exp!.




\subsubsection*{Restore}

The \verb!restore! command restores data created by the export command into the empty database.
The restore command is intended for migration between different releases of Sedna and for back
up of your data in XML format. The basic usage of this command is:

\begin{verbatim}
se_exp restore dbname path
\end{verbatim}  

The parameter \verb!dbname! specifies the database in Sedna to restore data into. The \verb!path!
parameter specifies the directory with data to restore. 

The database \verb!dbname! will not be created by this command. It is required that the target database 
already exist and run before starting the restore process. You must create it yourself with the help
of \verb!se_cdb! command and start it with \verb!se_sm! command. It is also required that the target 
database is empty, i.e. it doesn't contain any data or any users or roles except the default one.




\subsubsection*{Import}

The \verb!import! command imports data created by the export command into an existing database
which may be not empty. The basic usage of this command is:

\begin{verbatim}
se_exp import dbname path
\end{verbatim}  

The parameter \verb!dbname! specifies the database in Sedna to import data to. The \verb!path!
parameter specifies the directory with data to import. 

The database \verb!dbname! will not be created by this command. It is required that the target database 
already exist and run before starting the import process. 

You can import data into database which contains some data and has some security politics. The only
restriction is that there should not be any conflicts in the names of XML documents, collections or
indices. 

The main difference between \verb!restore! and \verb!import! command is that \verb!import! command 
doesn't import any security information. All data is imported by the user who run the \verb!se_exp! 
utility, i.e. by the user with the name and password specified with \verb!se_exp! parameters. Of cause 
this user should have enough rights to create collections, load documents and create indices.






\subsubsection{File system level backup}

An alternative strategy to backup a database is to directly copy the directories that Sedna
uses to store the data of the database. Read Section \ref{sec:dir-structure} to find out where
Sedna stores databases. You can use whatever method you prefer for doing usual file system backups.
To restore a database, copy the corresponding backup directory to the location where Sedna stores
databases.

There is a requirement is that the target database must be stopped in order to get a usable backup.
Half-way measures such as disallowing all connections will not work.

Note that a file system backup will not necessarily be smaller than an back up via export. On 
the contrary, it will most likely be larger.

\begin{note}
The database directory copied to different machine or different version of the same operating system 
might not work properly. If you want to restore a database on another machine or OS installation use
\verb!se_exp! utility instead.
\end{note}


\subsubsection{Migration Between Releases}

In this section we discuss how to migrate your data from one release of Sedna to another. 
As the internal data storage format is subject to change between different releases of Sedna it is a 
frequently required task to accurately migrate data.  

It is recommended that you use \verb!se_exp! utility to pass through this problem. The process 
consists of four steps.

\begin{enumerate}
\item
Run \verb!se_exp! utility with \verb!export! command to export your data to some 
directory on the filesystem.
\item
Shut down the old version of Sedna database server and remove it from your system. 
\item
Install and run a new version of Sedna, create the database with \verb!se_cdb! and start it with 
\verb!se_sm!. Make sure that no transaction has been run with the new database before restoring 
the data.
\item
Run \verb!se_exp! utility with \verb!restore! command to restore data into the new database
\end{enumerate}

\subsection{Event Log}
Sedna keeps track of all important events that happen during its functioning. You can find the log file named \verb!event.log! in the \verb!data! directory where Sedna stores databases. The location of the \verb!data! directory depends on the Sedna package you have used to install Sedna (see Section \ref{sec:dir-structure} for details).

\subsection{The Examples of Using Command Line Utilities}

In this section we present several examples of using the utilities described in the previous sections. These examples demonstrate how to create the database, run the Sedna server and the database, load documents into the database, run the query over the database, and finally stop Sedna.

For creating a database named \verb!xmark! with default settings use the following command:

\begin{verbatim}
se_cdb xmark
\end{verbatim}

To run Sedna, type the following command:

\begin{verbatim}
se_gov
\end{verbatim}

After execution of these commands the created database can be started up. To do it, type the following command:

\begin{verbatim}
se_sm xmark
\end{verbatim}

After it the xmark database is ready for serving user queries. Below we show how to load an XML document to the xmark database and how to write a queries over this document.

To load the XML document to the xmark database, pass the following steps:

\begin{enumerate}
\item Create the following file with name \verb!load.xquery!:

\begin{verbatim}
LOAD "<path>" "<name>"
\end{verbatim}

The \verb!<path>! is the path to the XML document to be loaded to the xmark database. The \verb!<name>! is the name of this document in the xmark database.

\item Run the command: 

\begin{verbatim}
se_term -file load.xquery xmark
\end{verbatim}

\item Create the following file with name \verb!query1.xquery!:

\begin{verbatim}
document("<name>")/*
\end{verbatim}

Where \verb!<name>! is the name of the loaded document in the xmark database.

\item Type the command and enter it:
\begin{verbatim}
se_term -file query1.xquery xmark
\end{verbatim}
\end{enumerate}

To stop Sedna and all its components and databases, type and enter the following command:

\begin{verbatim}
se_stop
\end{verbatim}



%========================================================================================
%
%
%                              Sedna users and privileges
%
%
%========================================================================================
\section{Sedna Database Users and Privileges}

Every Sedna database contains a set of database users. Those users are separate from the users managed by the operating system on which Sedna runs. Users own database object (for examples, documents) and can assign privileges on those objects to other users to control who has access to which object. 

This chapter describes how to create and manage users and introduces the privilege system.

\subsection{Database Users}

Database user names are global across a database (and not per all Sedna databases). \emph{Database users} interact with \emph{database objects}. Every database object has its \emph{owner} - the user that created it. Every user and \emph{role} (we will discuss roles in the Section \ref{roles}) has its \emph{creator}.

There are following kinds of Sedna database objects:
\begin{itemize}
\item standalone document
\item collection
\item index
\item module
\end{itemize}

There are two types of Sedna database users:

\begin{itemize}
\item Sedna database administrator (DBA user)
\item ordinary user (below we call "user")
\end{itemize}

Formally, DBA user is a user that has "DBA" role.

DBA user
\begin{itemize}
\item has all possible privileges on any object in the database;
\item can remove any object in the database;
\item can remove any user of the database;
\item can grant/revoke any privilege to/from any user of the database;
\item can grant "DBA" role to a user, thus making that user also a DBA user (not recommended, as the database with multiple DBA users is hard to administrate). Any DBA user can also revoke the "DBA" role from any DBA user.
\end{itemize}

A user
\begin{itemize}
\item can act according to the privileges that he has;
\item can grant and revoke any privileges on the database object that he owns to any user;
\item can remove database objects that he owns and drop users that he has created. 
\end{itemize}

Every user has its name and password.

To create a user use \verb!CREATE USER! statement:

\begin{verbatim}
CREATE USER "user-name" WITH PASSWORD "user-password"
\end{verbatim}

This statement creates a user with name \verb!user-name! with password \verb!user-password!.

To remove an existing user, use \verb!DROP USER! statement:

\begin{verbatim}
DROP USER "user-name"
\end{verbatim}

To change user password use \verb!ALTER USER! statement. A user can change a password for himself or for a user he has created. DBA user can change a password for any user of the database.

\begin{verbatim}
ALTER USER "user-name" WITH PASSWORD "new-password"
\end{verbatim}

This statement changes the password of the user \verb!user-name! to \verb!new-password!.

In order to bootstrap the database, a freshly created database always contains one predefined DBA user with name \verb!"SYSTEM"! and password \verb!"MANAGER"!. To start your work with the database, you first have to connect as this initial user, then you can create more users and change default password (if you care for preventing unauthorized access to your database).

\subsection{Privileges and Roles}
\label{roles}

When a database object is created, it is assigned an owner. The owner is the user that executed the creation statement. By default, only an owner and DBA user can do anything with the database object. In order to allow other users to use it, \emph{privileges} must be granted.

There are several possible privileges: 
\begin{itemize}
\item CREATE-USER
\item CREATE-DOCUMENT
\item CREATE-COLLECTION
\item CREATE-INDEX
\item LOAD-MODULE
\item LOAD
\item DROP
\item QUERY
\item INSERT
\item DELETE
\item RENAME
\item RETRIEVE-METADATA
\end{itemize}

Privileges are assigned to database objects or to the whole database. The table below for every privilege lists all kinds of database objects or the whole database it can be assigned to.

\begin{tabular}{|l|l|}
\hline
\hline
Privilege            & can be assigned to             \\
\hline
\hline
CREATE-USER          & DATABASE                       \\
\hline
CREATE-DOCUMENT      & DATABASE, COLLECTION           \\
\hline
CREATE-COLLECTION    & DATABASE                       \\
\hline
CREATE-INDEX         & DOCUMENT,COLLECTION            \\
\hline
LOAD-MODULE          & DATABASE                       \\
\hline
RETRIEVE-METADATA    & DATABASE                       \\
\hline
LOAD                 & DATABASE, COLLECTION           \\
\hline
DROP                 & DOCUMENT, COLLECTION, INDEX, MODULE    \\
\hline
QUERY                & DOCUMENT, COLLECTION           \\
\hline
INSERT               & DOCUMENT, COLLECTION           \\
\hline
DELETE               & DOCUMENT, COLLECTION           \\
\hline
RENAME               & DOCUMENT, COLLECTION           \\
\hline
\end{tabular}

Plus there is the key word \verb!ALL! that denotes all possible privilege that can be granted to the specified object.

Note, \verb!DROP! privilege on collection is granted to a user, this means that the user can drop any document in this collection (there is no such kind of database object as 'document in collection'). \verb!LOAD! privilege on database allows user to load standalone documents; \verb!LOAD! privilege on a collection allows user to load documents into the collection.

\emph{Role} is a named group of related privileges. Roles provide easy and controlled way to manage privileges. To create role \verb!CREATE ROLE! statement is used:

\begin{verbatim}
CREATE ROLE "role-name"
\end{verbatim}

This statement creates role with name "role-name". When created role does not contain any privileges. It is not recommeded to created a role with a name of an existing user (in this case privileges will be granted both to this user and to this role).

It is not allowed to use "DBA" and "PUBLIC" for naming roles as they are reserved by the system.

\subsection{Granting privileges}

Privileges are granted to users so that users can access and operate with database objects or to process some tasks with a database.

A user can receive a privilege in two different ways: privileges can be granted to user explicitly; or privileges can be granted to role, and the role can be granted to one or more users. Roles allow easier and better management of privileges, thus privileges are normally granted to roles and not to specific users. Roles can be granted both to users and to roles.

A user who has granted a privilege or a role is \emph{grantor} of this privilege (role).

To grant a privilege on a database object you must be an owner of this object or DBA user. To grant one or more privileges on a database object to one or more users or roles use:

%\begin{verbatim}
%GRANT "privilege" [, "privilege"] | ALL
%ON [DOCUMENT|COLLECTION] "database-object-name" 
%TO "user-name|role-name" [, "user-name|role-name"] | PUBLIC
%\end{verbatim}

\begin{verbatim}
GRANT "privilege" | ALL
ON [DOCUMENT|COLLECTION] "database-object-name" 
TO "user-name|role-name" | PUBLIC
\end{verbatim}

The key word \verb!PUBLIC! is used when the privileges are to be granted to all users, including those that may be created later. \verb!PUBLIC! may be thought of as an implicitly defined role that every user has.

If the kind of the database object (\verb!DOCUMENT! or \verb!COLLECTION!) is not specified, database object is considered to be a document.

To grant a privilege on a database you must be DBA user. To grant one or more privileges on a database to one or more users or roles use:

%\begin{verbatim}
%GRANT "privilege" [, "privilege"] | ALL
%ON DATABASE 
%TO "user-name|role-name" [, "user-name|role-name"] | PUBLIC
%\end{verbatim}

\begin{verbatim}
GRANT "privilege" | ALL
ON DATABASE 
TO "user-name|role-name" | PUBLIC
\end{verbatim}

To grant a role you must be allowed to grant every privilege of the role: to be owner of every database object of privileges of the role, or to be DBA user. To grant a role to one or more users or roles use:

%\begin{verbatim}
%GRANT "role-name" 
%TO "user-name|role_name" [, "user-name|role-name"] | PUBLIC
%\end{verbatim}

\begin{verbatim}
GRANT "role-name" 
TO "user-name|role_name" | PUBLIC
\end{verbatim}

\subsection{Revoking privileges}

Privileges or roles can be revoked from the user or role. Only grantor of the privilege (role) or DBA user can revoke privilege (role).

\verb!REVOKE! statements are similar to \verb!GRANT! statements.

To revoke one or more privileges on a database object from one or more users or roles use:

%\begin{verbatim}
%REVOKE "privilege" [, "privilege"] | ALL
%ON [DOCUMENT|COLLECTION] "database-object-name" 
%FROM "user-name|role-name" [, "user-name|role-name"] | PUBLIC
%\end{verbatim}

\begin{verbatim}
REVOKE "privilege" | ALL
ON [DOCUMENT|COLLECTION] "database-object-name" 
FROM "user-name|role-name" | PUBLIC
\end{verbatim}

If the kind of the database object (\verb!DOCUMENT! or \verb!COLLECTION!) is not specified, database object is considered to be a document.

To revoke one or more privileges on a database from one or more users or roles use:

%\begin{verbatim}
%REVOKE "privilege" [, "privilege"] | ALL
%ON DATABASE 
%FROM "user-name|role-name" [, "user-name|role-name"] | PUBLIC
%\end{verbatim}

\begin{verbatim}
REVOKE "privilege" | ALL
ON DATABASE 
FROM "user-name|role-name" | PUBLIC
\end{verbatim}

To revoke a role from one or more users or roles use:

%\begin{verbatim}
%REVOKE "role-name" 
%FROM "user-name|role-name" [, "user-name|role-name"] | PUBLIC
%\end{verbatim}

\begin{verbatim}
REVOKE "role-name" 
FROM "user-name|role-name" | PUBLIC
\end{verbatim}

As mentioned above DBA user is a user that has a "DBA" role. Thus, "DBA" is a reserved name for a role: a role with name "DBA" can not be created, privileges or roles cannot be granted to "DBA" role.

A DBA user can grant "DBA" role to another user, thus making that user also a DBA user. This is not recommended, as multiple powerful users of a database can lead to hard database administration, and can cause unsecure usage of the database and database objects.


\subsection{Client Authentication}

When a client application connects to the database server, it specifies which Sedna database user name it wants to connect as. Database user name determines access privileges to database objects, therefore, it is essential to restrict which database users can connect.

\emph{Authentication} is the process by which the database server establishes the identity of the client and determines whether the client application (or the user who runs the client application) is permitted to connect with the user name that was requested.

Currently, Sedna uses password authentication: client application that connects to the database must specify user name and user password (in \verb!se_term! utility use \verb!-pswd! and \verb!-name! options; for client application that works through Sedna API see "Sedna Programmer's Guide"). Authentication process consists in checking the password correctness.

A newly created database always contains one predefined DBA user with name \verb!"SYSTEM"! and password \verb!"MANAGER"!. To start your work with the database, you first have to connect as this initial user.

\section{Localization}
In the current version of Sedna all character data are stored internally in UTF-8.
All input queries and XML documents must be encoded in UTF-8.
All output is also encoded in UTF-8.


\end{document}

